<!--
Google IO 2012/2013 HTML5 Slide Template

Authors: Eric Bidelman <ebidel@gmail.com>
         Luke Mah√© <lukem@google.com>

URL: https://code.google.com/p/io-2012-slides
-->
<!DOCTYPE html>
<html>
<head>
  <title>25 MongoDB Aggregation Framework</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">-->
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0">-->
  <!--This one seems to work all the time, but really small on ipad-->
  <!--<meta name="viewport" content="initial-scale=0.4">-->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="stylesheet" media="all" href="theme/css/default.css">
  <link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="theme/css/phone.css">
  <base target="_blank"> <!-- This amazingness opens all links in a new tab. -->
  <script data-main="js/slides" src="js/require-1.0.8.min.js"></script>
</head>
<body style="opacity: 0">

<slides class="layout-widescreen"> 
<!--
  <slide class="logoslide nobackground">
    <article class="flexbox vcenter">
      <span><img src="images/ISIT311.png"></span>
    </article>
  </slide>
-->
<!-- slide 01 ================================================================================= -->
  <slide class="title-slide segue nobackground">
    <aside class="gdbar">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XBAU3014N Database Systems</aside>
    <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
    <hgroup class="auto-fadein">
      <h1 class="black" data-config-title>MongoDB Aggregation Framework</h1>
      <h2 class="black" data-config-subtitle><!-- populated from slide_config.json --></h2>
      <p class="black" data-config-presenter><!-- populated from slide_config.json --></p>
    </hgroup>
  </slide>
<!-- slide 02 ================================================================================= -->
  <slide>
    <hgroup>
      <h2 class="blue">MongoDB Aggregation Framework</h2>
      <h3 class="red">Outline</h3>
    </hgroup>
    <article>
      <ul>	
       <li><a class="red" href="#03">Aggregation framework ? What is it ?</a></li>
       <li><a href="#07">Sample database</a></li>
       <li><a href="#13">Aggregation operators</a></li>
	  <ul>
	   <li><a href="#13"><strong class="prettyprint">$project</strong></a></li>
	    <li><a href="#16"><strong class="prettyprint">$match</strong></a></li>
	    <li><a href="#19"><strong class="prettyprint">$limit</strong>, <strong class="prettyprint">$skip</strong> and <strong class="prettyprint">$sample</strong></a></li>
	    <li><a href="#22"><strong class="prettyprint">$sort</strong> and <strong class="prettyprint">$count</strong></a></li>
	    <li><a href="#25"><strong class="prettyprint">$unwind</strong></a></li>
	    <li><a href="#30"><strong class="prettyprint">$group</strong></a></li>
	    <li><a href="#37"><strong class="prettyprint">$out</strong></a></li>
    	    <li><a href="#43"><strong class="prettyprint">$lookup</strong></a></li>
	  </ul>
      </ul>
<footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 03 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue">Aggregation framework ? What is it ?</h2>
    </hgroup>
    <article>
      <ul class="build">
        <li><strong class="red">Aggregation framework</strong> is a query language that that can be used to <strong class="blue">transform</strong> and to <strong class="blue">combine</strong> data from multiple documents in order to <strong class="blue">generate</strong> new information not available in any single document</li>
	<li><strong class="red">Aggregation framework</strong> makes a task of database search much easier and more efficient through specification of a series of operations in an array and processing it in a single call</li>
	<li><strong class="red">Aggregation framework</strong> defines an <strong class="red">aggregation pipeline</strong> where the output from each step in the pipeline provides input to the next step
	    <p style="text-align:center;"><img src="images/0003.png" width="900" alt="ORM" title="ORM"></p>
	</li>
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
</slide>
<!-- slide 04 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue">Aggregation framework ? What is it ?</h2>
    </hgroup>
    <article>
      <ul class="build">
	<li>Every step in a <strong class="red">pipeline</strong> executes a single operation on the <strong class="red">input documents</strong> to transform the <strong class="red">input</strong> and to generate <strong class="red">output document</strong></li>
	<li>A <strong class="red">pipeline</strong> processes a <strong class="red">stream of documents</strong> through several operations like <strong class="blue">filtering</strong>, <strong class="blue">projecting</strong>, <strong class="blue">grouping</strong>, <strong class="blue">sorting</strong>, <strong class="blue">limiting</strong>, <strong class="blue">skipping</strong>, and the others</li>
	<li>The same operations can be repeated many times in a <strong class="red">pipeline</strong> in any order</li>
        <li><strong class="red">Aggregation framework</strong> in MongoDB is similar to  <strong class="red">SQL</strong> <strong class="green prettyprint">WITH</strong> clause of <strong class="green prettyprint28">SELECT</strong> statement</li>
       <li>Some of the <strong class="red">aggregation operators</strong> that can be used in an <strong class="red">aggregation pipeline</strong> in MongoDB are similar to  <strong class="red">SQL</strong> <strong class="green prettyprint28">SELECT</strong>, <strong class="green prettyprint28">WHERE</strong>, <strong class="green prettyprint">GROUP BY</strong>, <strong class="green prettyprint">HAVING</strong>, <strong class="green prettyprint28">ORDER BY</strong>, and <strong class="green prettyprint28">JOIN</strong> clauses</li>
	<li><strong class="red">Pipelined data processing</strong> is on of two basic way how data processing can be parallelised</li>
	<li>The other way is <strong class="red">partitioned data processing</strong></li>
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
</slide>
<!-- slide 05 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue">Aggregation framework</h2>
    </hgroup>
    <article>
      <ul class="build">
        <li>Some of the operators that can be used in an <strong class="red">aggregation pipeline</strong>:
	  <ul class="build">
	    <li><strong class="green prettyprint">$project</strong>: Extracts the components of a documents to be placed in an
	      output document (similar to <strong class="green prettyprint">SELECT</strong> clause)</li>
	    <li><strong class="green prettyprint">$match</strong>: Filters the documents to be processed, similar to <strong class="green prettyprint">find()</strong> (and
	      similar to <strong class="green prettyprint">WHERE</strong> clause)</li>
	    <li><strong class="green prettyprint">$limit</strong> and <strong class="green prettyprint">$skip</strong>:  Limits and skips the documents to be passed to the next operation</li>
	    <li><strong class="green prettyprint">$unwind</strong>: Expands (unnest) an array, generating one output document for each array entry</li>
	    <li><strong class="green prettyprint">$group</strong>: Groups documents by a specified key</li>
	    <li><strong class="green prettyprint">$sort</strong> and <strong class="green prettyprint28">$count</strong>: Sorts and counts the documents</li>
	    <li><strong class="green prettyprint">$out</strong>: Saves the results from a <strong class="red">pipeline</strong> to a collection</li>
	    <li><strong class="green prettyprint">$lookup</strong>: Joins two collections of documents</li>
	    <li><strong class="green prettyprint">$merge</strong>: Merges two collections of documents</li>
	  </ul>
	</li>
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 06 ================================================================================= -->
  <slide>
    <hgroup>
      <h2 class="blue">MongoDB Aggregation Framework</h2>
      <h3 class="red">Outline</h3>
    </hgroup>
    <article>
      <ul>	
       <li><a href="#03">Aggregation framework ? What is it ?</a></li>
       <li><a class="red" href="#07">Sample database</a></li>
       <li><a href="#13">Aggregation operators</a></li>
	  <ul>
	   <li><a href="#13"><strong class="prettyprint">$project</strong></a></li>
	    <li><a href="#16"><strong class="prettyprint">$match</strong></a></li>
	    <li><a href="#19"><strong class="prettyprint">$limit</strong>, <strong class="prettyprint">$skip</strong> and <strong class="prettyprint">$sample</strong></a></li>
	    <li><a href="#22"><strong class="prettyprint">$sort</strong> and <strong class="prettyprint">$count</strong></a></li>
	    <li><a href="#25"><strong class="prettyprint">$unwind</strong></a></li>
	    <li><a href="#30"><strong class="prettyprint">$group</strong></a></li>
	    <li><a href="#37"><strong class="prettyprint">$out</strong></a></li>
    	    <li><a href="#43"><strong class="prettyprint">$lookup</strong></a></li>
	  </ul>
      </ul>
<footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 07 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue">A sample database</h2>
    </hgroup>
    <article class="smaller">
      <ul class="build">
        <li>A conceptual schema of a database with information about <strong class="red">suppliers</strong>, <strong class="red">products</strong>,   <strong class="red">customers</strong>, <strong class="red">orders</strong>, and <strong class="red">details of orders</strong>
	  <ul class="build">
    	    <p style="text-align:center;"><img src="database/dbschema.png" width="850" alt="Logical schema" title="Logical schema"></p>
          </ul>
        </li>
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 08 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue">A sample database</h2>
    </hgroup>
    <article class="smaller">
      <ul class="build">
        <li>A sample collection <strong class="green prettyprint28">orders</strong></strong>
	  <ul class="build">
	    <p style="text-align:center;"><img src="database/bsonschema.png" width="500" alt="Logical schema" title="Logical schema"></p>
          </ul>
        </li>
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 09 ================================================================================= -->
  <slide>
    <hgroup>
      <h2 class="blue">A sample database</h2>
    </hgroup>
    <article>
      <ul class="build">
        <li>A sample document, that belongs to a class <strong class="green prettyprint28">CUSTOMER</strong>
          <ul class="build">
            <pre class="prettyprint" data-lang="CUSTOMER">{
        "_id":"ALFKI",
        "CUSTOMER":{
                 "customer code":"ALFKI",
                 "company name":"Alfreds Futterkiste",
                 "contact name":"Maria Anders",
                 "contact title":"Sales Representative",
                 "address":"Obere Str. 57",
                 "city":"Berlin",
                 "region":null,
                 "postal code":"12209",
                 "country":"Germany",
                 "phone":"030-0074321",
                 "fax":"030-0076545",
                 "submits":[ ]
        }
}</pre>
          </ul>
        </li>
      </ul>
     <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 10 ================================================================================= -->
  <slide>
    <hgroup>
      <h2 class="blue">A sample database</h2>
    </hgroup>
    <article class="smallest">
      <ul class="build">
        <li>A sample nested document, that belongs to a class <strong class="green prettyprint28">CUSTOMER</strong>
          <ul class="build">
            <pre class="prettyprint" data-lang="CUSTOMER">{
 "_id":"FAMIA",
 "CUSTOMER":{
               "customer code":"FAMIA",
                ...  ...  ...  ...  ...  ...
               "submits":[
                            {
                             "ORDER":{
                                        "order id":328,
                                         ...  ...  ...  ...  ...
                                        "consists of":[
                                                         {
                                                          "ORDER DETAIL":{
                                                                            "product name":"Louisiana Fiery Hot Pepper Sauce",
                                                                            ...  ...  ...  ...  ...
                                                                           }
                                                         },
                                                         {
                                                          "ORDER DETAIL":{
                                                                            "product name":"Raclette Courdavault",
	                                                                    ...  ...  ...  ...  ...
                                                                           }
                                                         }
                                                        ]
                                       }
                            }
	                   ]
	      }
	      
}</pre>
          </ul>
        </li>
      </ul>
     <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 11 ================================================================================= -->
  <slide>
    <hgroup>
      <h2 class="blue">A sample database</h2>
    </hgroup>
    <article class="smallest">
      <ul class="build">
        <li>A sample nested document, that belongs to a class <strong class="green prettyprint28">SUPPLIER</strong>
          <ul class="build">
            <pre class="prettyprint" data-lang="SUPPLIER">{
 "_id":"Karkki Oy",
 "SUPPLIER":{
               "company name":"Karkki Oy",
               "contact name":"Anne Heikkonen",
               "contact title":"Product Manager",
               "address":"Valtakatu 12",
               ...  ...  ...  ...  ...  ...
               "supplies":[
                             {
                              "PRODUCT":{
                                           "product name":"Maxilaku",
                                           "category name":"Confections",
                                            ...  ...  ...  ...  ... 
                                          }
                             },
                             {
                              "PRODUCT":{
                                           "product name":"Valkoinen suklaa",
                                           "category name":"Confections",
                                           ...  ...  ...  ...  ...
                                          }
                             }

                            ]
              }
}
</pre>
          </ul>
        </li>
      </ul>
     <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 12 ================================================================================= -->
  <slide>
    <hgroup>
      <h2 class="blue">MongoDB Aggregation Framework</h2>
      <h3 class="red">Outline</h3>
    </hgroup>
    <article>
      <ul>	
       <li><a href="#03">Aggregation framework ? What is it ?</a></li>
       <li><a href="#07">Sample database</a></li>
       <li><a class="red" href="#13">Aggregation operators</a></li>
	  <ul>
	   <li><a class="red" href="#13"><strong class="prettyprint">$project</strong></a></li>
	    <li><a href="#16"><strong class="prettyprint">$match</strong></a></li>
	    <li><a href="#19"><strong class="prettyprint">$limit</strong>, <strong class="prettyprint">$skip</strong> and <strong class="prettyprint">$sample</strong></a></li>
	    <li><a href="#22"><strong class="prettyprint">$sort</strong> and <strong class="prettyprint">$count</strong></a></li>
	    <li><a href="#25"><strong class="prettyprint">$unwind</strong></a></li>
	    <li><a href="#30"><strong class="prettyprint">$group</strong></a></li>
	    <li><a href="#37"><strong class="prettyprint">$out</strong></a></li>
    	    <li><a href="#43"><strong class="prettyprint">$lookup</strong></a></li>
	  </ul>
      </ul>
<footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 13 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue prettyprint">$project</h2>
    </hgroup>
    <article class=smaller>
      <ul class="build">
        <li>Operator <strong class="green prettyprint">$project</strong> extracts components of subdocuments, renames components, and performs operations on components</strong></li>
        <li>Select company name of each customer and skip document identifier
          <ul class="build">
            <pre class="prettyprint" data-lang="aggregate($project)">  
db.orders.aggregate([ {$project:{"CUSTOMER.company name":1,"_id":0}} ])</pre>
            <pre class="prettyprint" data-lang="The results">  
{ "CUSTOMER" : { "company name" : "Alfreds Futterkiste" } }
{ "CUSTOMER" : { "company name" : "Ana Trujillo Emparedados y helados" } }
{ "CUSTOMER" : { "company name" : "Antonio Moreno Taquer√≠a" } }
  ...            ...         ...</pre>
          </ul>
        </li>
        <li>Select company name of each customer and skip document identifier and <strong class="red">remove nestings</strong>
          <ul class="build">
	    <pre class="prettyprint" data-lang="aggregate($project)">  
db.orders.aggregate([ {$project:{"Company":"$CUSTOMER.company name","_id":0}} ])</pre>
            <pre class="prettyprint" data-lang="The results">  
{ "Company" : "Alfreds Futterkiste" }
{ "Company" : "Ana Trujillo Emparedados y helados" }
{ "Company" : "Antonio Moreno Taquer√≠a" }
  ...            ...         ...</pre>
          </ul>
        </li>
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 14 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue prettyprint">$project</h2>
    </hgroup>
    <article class=smaller>
      <ul class="build">
        <li><strong class="green prettyprint">"$keyname"</strong> syntax is used to refer to a value associated with a key <strong class="green prettyprint">"keyname"</strong> in the aggregation framework</li>
        <li>Select customer addresses and <strong class="red">remove nestings</strong>
          <ul class="build">
	    <pre class="prettyprint" data-lang="aggregate($project)">    
db.orders.aggregate([ {$project:{"Customer address":"$CUSTOMER.address","_id":0}} ])</pre>
	    <pre class="prettyprint" data-lang="The results">    
{ "Customer address" : "Obere Str. 57" }
{ "Customer address" : "Avda. de la Constituci√≥n 2222" }
{ "Customer address" : "Mataderos  2312" }
  ...            ...         ...</pre>
          </ul>
        </li>
        <li>Select a name of each customer and concatenate it with its code 
          <ul class="build">
	    <pre class="prettyprint" data-lang="aggregate($project)">    
db.orders.aggregate([ {$project:{"Customer address":{$concat:["$CUSTOMER.address",
                                                              "-",
                                                              "$CUSTOMER.customer code"]}}}])</pre>
	    <pre class="prettyprint" data-lang="The results">    
{ "_id" : "ALFKI", "Customer address" : "Johan Strauss Str. 23-ALFKI" }
{ "_id" : "ANATR", "Customer address" : "Avda. de la Constituci√≥n 2222-ANATR" }
{ "_id" : "ANTON", "Customer address" : "Mataderos  2312-ANTON" }
  ...            ...         ...</pre>
          </ul>
        </li>
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 15 ================================================================================= -->
  <slide>
    <hgroup>
      <h2 class="blue">MongoDB Aggregation Framework</h2>
      <h3 class="red">Outline</h3>
    </hgroup>
    <article>
      <ul>	
       <li><a href="#03">Aggregation framework ? What is it ?</a></li>
       <li><a href="#07">Sample database</a></li>
       <li><a class="red" href="#13">Aggregation operators</a></li>
	  <ul>
	    <li><a href="#13"><strong class="prettyprint">$project</strong></a></li>
	    <li><a class="red" href="#16"><strong class="prettyprint">$match</strong></a></li>
	    <li><a href="#19"><strong class="prettyprint">$limit</strong>, <strong class="prettyprint">$skip</strong> and <strong class="prettyprint">$sample</strong></a></li>
	    <li><a href="#22"><strong class="prettyprint">$sort</strong> and <strong class="prettyprint">$count</strong></a></li>
	    <li><a href="#25"><strong class="prettyprint">$unwind</strong></a></li>
	    <li><a href="#30"><strong class="prettyprint">$group</strong></a></li>
	    <li><a href="#37"><strong class="prettyprint">$out</strong></a></li>
    	    <li><a href="#43"><strong class="prettyprint">$lookup</strong></a></li>
	  </ul>
      </ul>
<footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 16 ================================================================================= -->
  <slide>
    <hgroup>
      <h2 class="blue prettyprint">$match</h2>
    </hgroup>
    <article class="smaller">
      <ul class="build">
        <li>Operator <strong class="green prettyprint">$match</strong> selects the documents that satisfy a given condition</li>
        <li>Find suppliers located in a city <strong class="green prettyprint28">Sandvika</strong>
	  <ul class="build">
            <pre class="prettyprint" data-lang="aggregate($match)">  
db.orders.aggregate([{$match:{"SUPPLIER.city":"Sandvika"}}])</pre>
            </ul>
	</li>
	<li>Find suppliers located in a city <strong class="green prettyprint28">Sandvika</strong> and display company name, city, and the names of product supplied
	  <ul class="build">
            <pre class="prettyprint" data-lang="aggregate($match,$project)">  
db.orders.aggregate([{$match:{"SUPPLIER.city":"Sandvika"}},
                     {$project:{"SUPPLIER.company name":1,"SUPPLIER.city":1,
                                "SUPPLIER.supplies.PRODUCT.product name":1,"_id":0}}])</pre>
	  </ul>
	</li>
	<li>Find suppliers located in <strong class="green prettyprint28">Germany</strong> supplying a product <strong class="green prettyprint28">Rossle Sauerkraut</strong> and display company name, city, and the names of product supplied
	  <ul class="build">
            <pre class="prettyprint" data-lang="aggregate($match,$match,$project)">  
db.orders.aggregate([{$match:{"SUPPLIER.country":"Germany"}},
                     {$match:{"SUPPLIER.supplies.PRODUCT.product name":"Rossle Sauerkraut"}},
                     {$project:{"SUPPLIER.company name":1,"SUPPLIER.city":1,
                                "SUPPLIER.supplies.PRODUCT.product name":1,"_id":0}}])</pre>
	  </ul>
	</li>	
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 17 ================================================================================= -->
  <slide>
    <hgroup>
      <h2 class="blue prettyprint">$match</h2>
    </hgroup>
    <article class="smaller">
      <ul class="build">
	<li>Find suppliers located in a city <strong class="green prettyprint28">Sandvika</strong> and display company name, city, and the names of product supplied</li>
	<li>Incorrect implementation of projection
	  <ul class="build">
            <pre class="prettyprint" data-lang="aggregate($match,$project)">  
db.orders.aggregate([{$match:{"SUPPLIER.city":"Sandvika"}},
   	             {$project:{"SUPPLIER.company name":1}},
	             {$project:{"SUPPLIER.city":1}},
	             {$project:{"SUPPLIER.supplies.PRODUCT.product name":1,"_id":0}}])</pre>
            <pre class="prettyprint" data-lang="The results">  
{ "SUPPLIER" : {  } })</pre>
	  </ul>
	</li>	
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 18 ================================================================================= -->
  <slide>
    <hgroup>
      <h2 class="blue">MongoDB Aggregation Framework</h2>
      <h3 class="red">Outline</h3>
    </hgroup>
    <article>
      <ul>	
       <li><a href="#03">Aggregation framework ? What is it ?</a></li>
       <li><a href="#07">Sample database</a></li>
       <li><a class="red" href="#13">Aggregation operators</a></li>
	  <ul>
	    <li><a href="#13"><strong class="prettyprint">$project</strong></a></li>
	    <li><a href="#16"><strong class="prettyprint">$match</strong></a></li>
	    <li><a class="red" href="#19"><strong class="prettyprint">$limit</strong>, <strong class="prettyprint">$skip</strong> and <strong class="prettyprint">$sample</strong></a></li>
	    <li><a href="#22"><strong class="prettyprint">$sort</strong> and <strong class="prettyprint">$count</strong></a></li>
	    <li><a href="#25"><strong class="prettyprint">$unwind</strong></a></li>
	    <li><a href="#30"><strong class="prettyprint">$group</strong></a></li>
	    <li><a href="#37"><strong class="prettyprint">$out</strong></a></li>
    	    <li><a href="#43"><strong class="prettyprint">$lookup</strong></a></li>
	  </ul>
      </ul>
<footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 19 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue prettyprint">$limit, $skip and $sample</h2>
    </hgroup>
    <article class="smaller">
      <ul class="build">
        <li>Operation <strong class="green prettyprint">$limit</strong> passes a given number of documents through a pipeline</li>
        <li>Operation <strong class="green prettyprint">$skip</strong> eliminates a given number of documents from a pipeline</li>
        <li>Operation <strong class="green prettyprint">$sample</strong> randomly picks a given number of documents from a pipeline</li>	
        <li>Find the first two suppliers 
	  <ul class="build">
            <pre class="prettyprint" data-lang="aggregate($match,$limit)">  
db.orders.aggregate([{$match:{"SUPPLIER":{$exists:true}}},
                     {$limit:2}])</pre>
	  </ul>
	</li>
	<li>Find all suppliers except the first two
	  <ul class="build">
	    <pre class="prettyprint" data-lang="aggregate($match,$skip)">  
db.orders.aggregate([{$match:{"SUPPLIER":{$exists:true}}},
                     {$skip:2}])</pre>
	  </ul>
	</li>	
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 20 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue prettyprint">$limit, $skip and $sample</h2>
    </hgroup>
    <article class="smaller">
      <ul class="build">
	<li>Find the third and the fourth supplier
	  <ul class="build">
	    <pre class="prettyprint" data-lang="aggregate($match,$limit,$skip)">  
db.orders.aggregate([{$match:{"SUPPLIER":{$exists:true}}},
                     {$limit:4},
                     {$skip:2}])</pre>
<pre class="prettyprint" data-lang="aggregate($match,$skip,$limit)">  	    
db.orders.aggregate([{$match:{"SUPPLIER":{$exists:true}}},
                     {$skip:2},
                     {$limit:2}])</pre>	    
         </ul>
	</li>
	<li>Find all customers located in France and list the sample 2 documents
	  <ul class="build">
	    <pre class="prettyprint" data-lang="aggregate($match,$sample)">  
db.orders.aggregate([{$match:{"CUSTOMER.country":"France"}},
                     {$sample:{size:2}}])</pre>	    
         </ul>
	</li>
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 21 ================================================================================= -->
  <slide>
    <hgroup>
      <h2 class="blue">MongoDB Aggregation Framework</h2>
      <h3 class="red">Outline</h3>
    </hgroup>
    <article>
      <ul>	
       <li><a href="#03">Aggregation framework ? What is it ?</a></li>
       <li><a href="#07">Sample database</a></li>
       <li><a class="red" href="#13">Aggregation operators</a></li>
	  <ul>
	    <li><a href="#13"><strong class="prettyprint">$project</strong></a></li>
	    <li><a href="#16"><strong class="prettyprint">$match</strong></a></li>
	    <li><a href="#19"><strong class="prettyprint">$limit</strong>, <strong class="prettyprint">$skip</strong> and <strong class="prettyprint">$sample</strong></a></li>
	    <li><a class="red" href="#22"><strong class="prettyprint">$sort</strong> and <strong class="prettyprint">$count</strong></a></li>
	    <li><a href="#25"><strong class="prettyprint">$unwind</strong></a></li>
	    <li><a href="#30"><strong class="prettyprint">$group</strong></a></li>
	    <li><a href="#37"><strong class="prettyprint">$out</strong></a></li>
    	    <li><a href="#43"><strong class="prettyprint">$lookup</strong></a></li>
	  </ul>
      </ul>
<footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 22 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue prettyprint">$count</h2>
    </hgroup>
    <article class = "smaller">
      <ul class="build">
        <li>Operation <strong class="green prettyprint">$count</strong> counts the total number of documents in a pipeline</li>
        <li>List the total number of documents in a collection <strong class="green prettyprint28">orders</strong>
	  <ul class="build">
            <pre class="prettyprint" data-lang="aggregate($count)">  
db.orders.aggregate([{$count:"Total documents"}])</pre>
            <pre class="prettyprint" data-lang="A result of counting">   
{ "Total documents" : 117 }</pre>
	  </ul>
	</li>
	<li>Find the total number of suppliers located in Canada
	  <ul class="build">
            <pre class="prettyprint" data-lang="aggregate($match,$count)">   
db.orders.aggregate([{$match:{"SUPPLIER.country":"Canada"}},
                     {$count:"Total suppliers in Canada"}]))</pre>
            <pre class="prettyprint" data-lang="A result of counting">   
{ "Total suppliers in Canada" : 2 }</pre>
	  </ul>
	</li>
      </ul>
     <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 23 ================================================================================== -->
<slide>
    <hgroup>
      <h2 class="blue prettyprint">$sort</h2>
    </hgroup>
    <article class="smaller">
      <ul class="build">
        <li>Operation <strong class="green prettyprint">$sort</strong> sorts the documents</li>
        <li>Display the names of companies of all suppliers located in <strong class="green prettyprint28">Canada</strong> and sort the names in ascending order
	  <ul class="build">
            <pre class="prettyprint" data-lang="aggregate($match,$project,$sort)">   
db.orders.aggregate([{$match:{"SUPPLIER.country":"Canada"}},
                     {$project:{"SUPPLIER.company name":1,"_id":0}},
                     {$sort:{"SUPPLIER.company name":1}}])</pre>
	  </ul>
	</li>
	<li>Why the following solution is worse than the one above ?
	  <ul class="build">
            <pre class="prettyprint" data-lang="aggregate($sort,$match,$project)">   
db.orders.aggregate([{$sort:{"SUPPLIER.company name":1}},
                     {$match:{"SUPPLIER.country":"Canada"}},
                     {$project:{"SUPPLIER.company name":1,"_id":0}} ]))</pre>
	  </ul>
	</li>
	<li>Find a company name and postal code of supplier that has the largest postal code
	  <ul class="build">
            <pre class="prettyprint" data-lang="aggregate($match,$project,$sort)">   
db.orders.aggregate([{$match:{"SUPPLIER":{$exists:true}}},
                     {$project:{"SUPPLIER.company name":1,"SUPPLIER.postal code":1,"_id":0}},
                     {$sort:{"SUPPLIER.postal code":-1}},
                     {$limit:1}])))</pre>
	  </ul>
	</li>
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 24 ================================================================================= -->
  <slide>
    <hgroup>
      <h2 class="blue">MongoDB Aggregation Framework</h2>
      <h3 class="red">Outline</h3>
    </hgroup>
    <article>
      <ul>	
       <li><a href="#03">Aggregation framework ? What is it ?</a></li>
       <li><a href="#07">Sample database</a></li>
       <li><a class="red" href="#13">Aggregation operators</a></li>
	  <ul>
	    <li><a href="#13"><strong class="prettyprint">$project</strong></a></li>
	    <li><a href="#16"><strong class="prettyprint">$match</strong></a></li>
	    <li><a href="#19"><strong class="prettyprint">$limit</strong>, <strong class="prettyprint">$skip</strong> and <strong class="prettyprint">$sample</strong></a></li>
	    <li><a href="#22"><strong class="prettyprint">$sort</strong> and <strong class="prettyprint">$count</strong></a></li>
	    <li><a class="red" href="#25"><strong class="prettyprint">$unwind</strong></a></li>
	    <li><a href="#30"><strong class="prettyprint">$group</strong></a></li>
	    <li><a href="#37"><strong class="prettyprint">$out</strong></a></li>
    	    <li><a href="#43"><strong class="prettyprint">$lookup</strong></a></li>
	  </ul>
      </ul>
<footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 25 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue prettyprint">$unwind</h2>
    </hgroup>
    <article class="smaller">
      <ul class="build">
        <li>Operation <strong class="green prettyprint">$unwind</strong> creates a separate document for each element of a given
array</li>
	<li>A document is replicated for each element of an array, i.e. an array is <strong class="red">unnested</strong></li>
        <li>List the names of products supplied by the first 2 suppliers
	  <ul class="build">
            <pre class="prettyprint" data-lang="aggregate($match,$limit,$project)">    
db.orders.aggregate([{$match:{"SUPPLIER":{$exists:true}}},
                     {$limit:2},
                     {$project:{"SUPPLIER.supplies.PRODUCT.product name":1,"_id":0}}])</pre>
            <pre class="prettyprint" data-lang="The results">    
{ "SUPPLIER" : { "supplies" : [ { "PRODUCT" : { "product name" : "C√¥te de Blaye" } } ] } }
{ "SUPPLIER" : { "supplies" : [ { "PRODUCT" : { "product name" : "Sasquatch Ale" } },
                                { "PRODUCT" : { "product name" : "Steeleye Stout" } },
                                { "PRODUCT" : { "product name" : "Laughing Lumberjack Lager" } } ] } }</pre>	    
	  </ul>
	</li>
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 26 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue prettyprint">$unwind</h2>
    </hgroup>
    <article class="smaller">
      <ul class="build">
        <li>List the names of products supplied by the first 2 suppliers
	  <ul class="build">
            <pre class="prettyprint" data-lang="aggregate($match,$limit,$project)">    
db.orders.aggregate([{$match:{"SUPPLIER":{$exists:true}}},
                     {$limit:2},
                     {$project:{"product":"$SUPPLIER.supplies.PRODUCT.product name","_id":0}}])</pre>
            <pre class="prettyprint" data-lang="The results">    
{ "product" : [ "C√¥te de Blaye" ] }
{ "product" : [ "Sasquatch Ale", "Steeleye Stout", "Laughing Lumberjack Lager" ] }</pre>	    
	  </ul>
	  <ul class="build">
            <pre class="prettyprint" data-lang="aggregate($match,$limit,$unwind,$project)">    
db.orders.aggregate([{$match:{"SUPPLIER":{$exists:true}}},
                     {$limit:2},
                     {$unwind:"$SUPPLIER.supplies"},
                     {$project:{"product":"$SUPPLIER.supplies.PRODUCT.product name","_id":0}}])</pre>
            <pre class="prettyprint" data-lang="The results">    
{ "product" : "C√¥te de Blaye" }
{ "product" : "Sasquatch Ale" }
{ "product" : "Steeleye Stout" }
{ "product" : "Laughing Lumberjack Lager" }</pre>	    
	  </ul>
	</li>
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 27 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue prettyprint">$unwind</h2>
    </hgroup>
    <article class="smallest">
      <ul class="build">
        <li>List the names of suppliers (companies) and the names of products supplied by the first 2 suppliers
	  <ul class="build">
            <pre class="prettyprint" data-lang="aggregate($match,$limit,$unwind,$project)">    
db.orders.aggregate([{$match:{"SUPPLIER":{$exists:true}}},
                     {$limit:2},
                     {$project:{"supplier":"$SUPPLIER.company name",
                                "product":"$SUPPLIER.supplies.PRODUCT.product name",
                                "_id":0}}])</pre>
            <pre class="prettyprint" data-lang="The results">    
{ "supplier" : "Aux joyeux ecclesiastiques", "product" : [ "C√¥te de Blaye" ] }
{ "supplier" : "Bigfoot Breweries", "product" : [ "Sasquatch Ale", "Steeleye Stout", "Laughing Lumberjack Lager" ]</pre>	    
            <pre class="prettyprint" data-lang="aggregate($match,$limit,$unwind,$project)">    
db.orders.aggregate([{$match:{"SUPPLIER":{$exists:true}}},
                     {$limit:2},
                     {$unwind:"$SUPPLIER.supplies"},
                     {$project:{"supplier":"$SUPPLIER.company name",
                                "product":"$SUPPLIER.supplies.PRODUCT.product name",
                                "_id":0}}])</pre>
            <pre class="prettyprint" data-lang="The results">    
{ "supplier" : "Aux joyeux ecclesiastiques", "product" : "C√¥te de Blaye" }
{ "supplier" : "Bigfoot Breweries", "product" : "Sasquatch Ale" }
{ "supplier" : "Bigfoot Breweries", "product" : "Steeleye Stout" }
{ "supplier" : "Bigfoot Breweries", "product" : "Laughing Lumberjack Lager" }</pre>	    
	  </ul>
	</li>
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 28 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue prettyprint">$unwind</h2>
    </hgroup>
    <article class="smaller">
      <ul class="build">
        <li>List the total number of products supplied by the first 2 suppliers
	  <ul class="build">
            <pre class="prettyprint" data-lang="aggregate($match,$limit,$unwind,$project,$count)">   
 db.orders.aggregate([{$match:{"SUPPLIER":{$exists:true}}},
                      {$limit:2},
                      {$unwind:"$SUPPLIER.supplies"},
                      {$project:{"product":"$SUPPLIER.supplies.PRODUCT.product name","_id":0}},
                      {$count:"Total number of products supplied by the first 2 suppliers"}])</pre>
            <pre class="prettyprint" data-lang="The results">    
{ "Total number of products supplied by the first 2 suppliers" : 4 }</pre>	    
	  </ul>
	</li>
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 29 ================================================================================= -->
  <slide>
    <hgroup>
      <h2 class="blue">MongoDB Aggregation Framework</h2>
      <h3 class="red">Outline</h3>
    </hgroup>
    <article>
      <ul>	
       <li><a href="#03">Aggregation framework ? What is it ?</a></li>
       <li><a href="#07">Sample database</a></li>
       <li><a class="red" href="#13">Aggregation operators</a></li>
	  <ul>
	    <li><a href="#13"><strong class="prettyprint">$project</strong></a></li>
	    <li><a href="#16"><strong class="prettyprint">$match</strong></a></li>
	    <li><a href="#19"><strong class="prettyprint">$limit</strong>, <strong class="prettyprint">$skip</strong> and <strong class="prettyprint">$sample</strong></a></li>
	    <li><a href="#22"><strong class="prettyprint">$sort</strong> and <strong class="prettyprint">$count</strong></a></li>
	    <li><a href="#25"><strong class="prettyprint">$unwind</strong></a></li>
	    <li><a class="red" href="#30"><strong class="prettyprint">$group</strong></a></li>
	    <li><a href="#37"><strong class="prettyprint">$out</strong></a></li>
    	    <li><a href="#43"><strong class="prettyprint">$lookup</strong></a></li>
	  </ul>
      </ul>
<footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 30 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue prettyprint">$group</h2>
    </hgroup>
    <article class="smaller">
      <ul class="build">
        <li>Operation <strong class="green prettyprint">$group</strong> groups the documents and applies the aggregation functions
to each group</li>
        <li>Find the total number of suppliers 
	  <ul class="build">
	    <pre class="prettyprint" data-lang="aggregate($match,$count)">   
db.orders.aggregate([{$match:{"SUPPLIER":{$exists:true}}},
                     {$count:"total"}]) </pre>
	    <pre class="prettyprint" data-lang="aggregate($match,$group)">  
db.orders.aggregate([{$match:{"SUPPLIER":{$exists:true}}},
                     {$group:{"_id": null,"total":{$sum:1}}}])}</pre>
	  </ul>
	</li>
	<li>Find the names of countries, the suppliers come from
	  <ul class="build">
            <pre class="prettyprint" data-lang="aggregate($match,$project)">   
db.orders.aggregate([{$match:{"SUPPLIER":{$exists:true}}},
                     {$project:{"country":"$SUPPLIER.country","_id":0}}])</pre>
	  </ul>
	</li>
	<li>Find the <strong class="red">distinct</strong> names of countries, the suppliers come from
	  <ul class="build">
	    <pre class="prettyprint" data-lang="aggregate($match,$project$,$group)">   
db.orders.aggregate([{$match:{"SUPPLIER":{$exists:true}}},
                     {$project:{"country":"$SUPPLIER.country","_id":0}},
                     {$group:{"_id":"$country"}}]))</pre>
	  </ul>
	</li>
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 31 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue prettyprint">$group</h2>
    </hgroup>
    <article class="smaller">
      <ul class="build">
        <li>Find distinct country names together with the total number of suppliers per country
	  <ul class="build">
            <pre class="prettyprint" data-lang="aggregate($match,$group)">   
db.orders.aggregate([{$match:{"SUPPLIER":{$exists:true}}},
                     {$group:{"_id":"$SUPPLIER.country","total":{$sum:1}}}])</pre>
	    <pre class="prettyprint" data-lang="The results">   
{ "_id" : "Italy", "total" : 2 }
{ "_id" : "Sweden", "total" : 1 }
{ "_id" : "Germany", "total" : 3 }	      
  ...            ...         ...</pre>

	  </ul>
	</li>
        <li>Find distinct country names together with the total number of suppliers per country
	  <ul class="build">
            <pre class="prettyprint" data-lang="aggregate($match,$project,$group)">   
db.orders.aggregate([{$match:{"SUPPLIER":{$exists:true}}},
                     {$project:{"country":"$SUPPLIER.country","_id":0}},
                     {$group:{"_id":"$country","total":{$sum:1}}}])</pre>
	    <pre class="prettyprint" data-lang="The results">   
{ "_id" : "Italy", "total" : 2 }
{ "_id" : "Sweden", "total" : 1 }
{ "_id" : "Germany", "total" : 3 }	      
  ...            ...         ...</pre>
	  </ul>
	</li>
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 32 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue prettyprint">$group</h2>
    </hgroup>
    <article class="smaller">
      <ul class="build">
	<li>Find the total number of products supplied by each supplier</strong>
	  <ul class="build">
            <pre class="prettyprint" data-lang="aggregate($match,$unwind,$project)">   
db.orders.aggregate([{$match:{"SUPPLIER":{$exists:true}}},
                     {$unwind:"$SUPPLIER.supplies"},
                     {$project:{"supplier":"$SUPPLIER.company name",
                                "product":"$SUPPLIER.supplies.PRODUCT.product name",
                                "_id":0}} ])</pre>
		  	    <pre class="prettyprint" data-lang="The results">
{ "supplier" : "Aux joyeux ecclesiastiques", "product" : "C√¥te de Blaye" }
{ "supplier" : "Bigfoot Breweries", "product" : "Sasquatch Ale" }
{ "supplier" : "Bigfoot Breweries", "product" : "Steeleye Stout" }
{ "supplier" : "Bigfoot Breweries", "product" : "Laughing Lumberjack Lager" }
  ...            ...         ...</pre>
            <pre class="prettyprint" data-lang="aggregate($match,$unwind,$project,$group)">   
db.orders.aggregate([{$match:{"SUPPLIER":{$exists:true}}},
                     {$unwind:"$SUPPLIER.supplies"},
                     {$project:{"supplier":"$SUPPLIER.company name",
                                "product":"$SUPPLIER.supplies.PRODUCT.product name",
                                "_id":0}},
                     {$group:{"_id":"$supplier","total":{$sum:1}}}])</pre>
		  	    <pre class="prettyprint" data-lang="The results">
{ "_id" : "Aux joyeux ecclesiastiques", "total" : 1 }
{ "_id" : "Bigfoot Breweries", "total" : 3 }
  ...            ...         ...</pre>
	  </ul>
      </ul>
     <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 33 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue prettyprint">$group</h2>
    </hgroup>
    <article class="smaller">
      <ul class="build">
	<li>Find the total prices of products per supplier</strong>
	  <ul class="build">
            <pre class="prettyprint" data-lang="aggregate($match,$unwind,$project)">   
db.orders.aggregate([{$match:{"SUPPLIER":{$exists:true}}},
                     {$unwind:"$SUPPLIER.supplies"},
                     {$project:{"supplier":"$SUPPLIER.company name",
                                "price":"$SUPPLIER.supplies.PRODUCT.unit price",
                                "_id":0}} ])</pre>
		  	    <pre class="prettyprint" data-lang="The results">
{ "supplier" : "Aux joyeux ecclesiastiques", "price" : 263.5 }
{ "supplier" : "Bigfoot Breweries", "price" : 14 }
{ "supplier" : "Bigfoot Breweries", "price" : 18 }
{ "supplier" : "Bigfoot Breweries", "price" : 14 }
  ...            ...         ...</pre>
            <pre class="prettyprint" data-lang="aggregate($match,$unwind,$project,$group)">   
db.orders.aggregate([{$match:{"SUPPLIER":{$exists:true}}},
                     {$unwind:"$SUPPLIER.supplies"},
                     {$project:{"supplier":"$SUPPLIER.company name",
                                "product":"$SUPPLIER.supplies.PRODUCT.product name",
                                "price":"$SUPPLIER.supplies.PRODUCT.unit price",
                                "_id":0}},
                     {$group:{"_id":"$supplier","total":{$sum:"$price"}}}])</pre>
		  	    <pre class="prettyprint" data-lang="The results">
{ "_id" : "Aux joyeux ecclesiastiques", "total" : 263.5 }
{ "_id" : "Bigfoot Breweries", "total" : 46 }
  ...            ...         ...</pre>
	  </ul>
      </ul>
     <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 34 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue prettyprint">$group</h2>
    </hgroup>
    <article class="smaller">
      <ul class="build">
	<li>Find the averages of all prices of products per supplier
	  <ul class="build">
            <pre class="prettyprint" data-lang="aggregate($match,$unwind,$project,$group)">    
db.orders.aggregate([{$match:{"SUPPLIER":{$exists:true}}},
                     {$unwind:"$SUPPLIER.supplies"},
                     {$project:{"supplier":"$SUPPLIER.company name",
                                "price":"$SUPPLIER.supplies.PRODUCT.unit price",
                                "_id":0}},
                     {$group:{"_id":"$supplier","average":{$avg:"$price"}}}])}</pre>
		  	    <pre class="prettyprint" data-lang="The results">  
{ "_id" : "Aux joyeux ecclesiastiques", "average" : 263.5 }
{ "_id" : "Bigfoot Breweries", "average" : 15.333333333333334}
  ...            ...         ...</pre>
	  </ul>
	</li>
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 35 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue prettyprint">$group</h2>
    </hgroup>
    <article class="smaller">
      <ul class="build">
	<li>Find the minimum and maximum prices of products per supplier
	  <ul class="build">
            <pre class="prettyprint" data-lang="aggregate($match,$unwind,$project,$group)">        
db.orders.aggregate([{$match:{"SUPPLIER":{$exists:true}}},
                     {$unwind:"$SUPPLIER.supplies"},
                     {$project:{"supplier":"$SUPPLIER.company name",
                                "price":"$SUPPLIER.supplies.PRODUCT.unit price",
                                "_id":0}},
                     {$group:{"_id":"$supplier","min":{$min:"$price"},"max":{$max:"$price"}}}])</pre>    
		  	    <pre class="prettyprint" data-lang="The results">  
{ "_id" : "Aux joyeux ecclesiastiques", "min" : 263.5, "max" : 263.5 }
{ "_id" : "Bigfoot Breweries", "min" : 14, "max" : 18 }
  ...            ...         ...</pre>
          </ul>
	</li>
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 36 ================================================================================= -->
  <slide>
    <hgroup>
      <h2 class="blue">MongoDB Aggregation Framework</h2>
      <h3 class="red">Outline</h3>
    </hgroup>
    <article>
      <ul>	
       <li><a href="#03">Aggregation framework ? What is it ?</a></li>
       <li><a href="#07">Sample database</a></li>
       <li><a class="red" href="#13">Aggregation operators</a></li>
	  <ul>
	    <li><a href="#13"><strong class="prettyprint">$project</strong></a></li>
	    <li><a href="#16"><strong class="prettyprint">$match</strong></a></li>
	    <li><a href="#19"><strong class="prettyprint">$limit</strong>, <strong class="prettyprint">$skip</strong> and <strong class="prettyprint">$sample</strong></a></li>
	    <li><a href="#22"><strong class="prettyprint">$sort</strong> and <strong class="prettyprint">$count</strong></a></li>
	    <li><a href="#25"><strong class="prettyprint">$unwind</strong></a></li>
	    <li><a href="#30"><strong class="prettyprint">$group</strong></a></li>
	    <li><a class="red" href="#37"><strong class="prettyprint">$out</strong></a></li>
    	    <li><a href="#43"><strong class="prettyprint">$lookup</strong></a></li>
	  </ul>
      </ul>
<footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 37 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue prettyprint">$out</h2>
    </hgroup>
    <article class="smaller">
      <ul class="build">
        <li>Operation <strong class="green prettyprint">$out</strong> saves the results of processing in a collection</li>	
        <li>Find the customer code and the names of products purchased by a customer with a customer code <strong class="green prettyprint28">AROUT</strong> and save the result in a collection <strong class="green prettyprint28">"purchases"</strong>
	  <ul class="build">
	    <pre class="prettyprint" data-lang="aggregate($match,$project)">   
db.orders.aggregate([{$match:{"CUSTOMER.customer code":"AROUT"}},
                     {$project:{"Code":"$CUSTOMER.customer code",                        
                       "Purchased":"$CUSTOMER.submits.ORDER.consists of.ORDER DETAIL.product name"}} ])</pre>
	    <pre class="prettyprint" data-lang="The results">
{ "_id" : "AROUT","Code" : "AROUT", "Purchased" : [
                                                    [
                                                      "Gorgonzola Telino",
                                                      "Grandma's Boysenberry Spread",
                                                      "Konbu",
                                                      "Mozzarella di Giovanni",
                                                      "Tofu"
                                                    ]
                                                  ]
}</pre>
	  </ul>
	</li>
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 38 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue prettyprint">$out</h2>
    </hgroup>
    <article class="smaller">
      <ul class="build">
        <li>Find the customer code and the names of products purchased by a customer with a customer code <strong class="green prettyprint28">AROUT</strong> and save the result in a collection <strong class="green prettyprint28">"purchases"</strong>
	  <ul class="build">
	    <pre class="prettyprint" data-lang="aggregate($match,$project,$unwind)">   
db.orders.aggregate([{$match:{"CUSTOMER.customer code":"AROUT"}},
                     {$project:{"Code":"$CUSTOMER.customer code",                        
                          "Purchased":"$CUSTOMER.submits.ORDER.consists of.ORDER DETAIL.product name"}},
                     {$unwind:"$Purchased"}])</pre>
	    <pre class="prettyprint" data-lang="The results">
{ "_id" : "AROUT","Code" : "AROUT", "Purchased" : [
                                                    "Gorgonzola Telino",
                                                    "Grandma's Boysenberry Spread",
                                                    "Konbu",
                                                    "Mozzarella di Giovanni",
                                                    "Tofu"
                                                  ]
}</pre>
	  </ul>
	</li>
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 39 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue prettyprint">$out</h2>
    </hgroup>
    <article class="smallest">
      <ul class="build">
        <li>Find the customer code and the names of products purchased by a customer with a customer code <strong class="green prettyprint28">AROUT</strong> and save the result in a collection <strong class="green prettyprint28">"purchases"</strong>
	  <ul class="build">
	    <pre class="prettyprint" data-lang="aggregate($match,$project,$unwind,$unwind)">   
db.orders.aggregate([{$match:{"CUSTOMER.customer code":"AROUT"}},
                     {$project:{"Code":"$CUSTOMER.customer code",                        
                          "Purchased":"$CUSTOMER.submits.ORDER.consists of.ORDER DETAIL.product name"}},
                     {$unwind:"$Purchased"},
                     {$unwind:"$Purchased"}])</pre>
	    <pre class="prettyprint" data-lang="The results">   
{ "_id" : "AROUT", "Code" : "AROUT", "Purchased" : "Gorgonzola Telino" }
{ "_id" : "AROUT", "Code" : "AROUT", "Purchased" : "Grandma's Boysenberry Spread" }
{ "_id" : "AROUT", "Code" : "AROUT", "Purchased" : "Konbu" }
{ "_id" : "AROUT", "Code" : "AROUT", "Purchased" : "Mozzarella di Giovanni" }
{ "_id" : "AROUT", "Code" : "AROUT", "Purchased" : "Tofu" }</pre>
	    <pre class="prettyprint" data-lang="$match,$project,$unwind,$unwind,$out">      
db.orders.aggregate([{$match:{"CUSTOMER.customer code":"AROUT"}},
                     {$project:{"Code":"$CUSTOMER.customer code",                        
                          "Purchased":"$CUSTOMER.submits.ORDER.consists of.ORDER DETAIL.product name"}},
                     {$unwind:"$Purchased"},
                     {$unwind:"$Purchased"},
                     {$project:{"_id":0}},
                     {$out:"purchases"}])</pre>
<pre class="prettyprint" data-lang="find()">      
db.purchases.find().pretty()</pre>	    
	  </ul>
	</li>
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide><
<!-- slide 40 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue prettyprint">$out</h2>
    </hgroup>
    <article class="smaller">
      <ul class="build">
        <li>Find the names, categories, and unit prices of all products supplied and save the result in a collection <strong class="green prettyprint28">"products"</strong>
	  <ul class="build">
	    <pre class="prettyprint" data-lang="aggregate($project)">    
db.orders.aggregate([{$project:{"product":"$SUPPLIER.supplies.PRODUCT",
                                "_id":0 }} ])</pre>
	    <pre class="prettyprint" data-lang="The results">   
{ "product" : [ { "product name" : "Chef Anton's Cajun Seasoning",
                  "category name" : "Condiments",
                  "quantity per unit" : "48 - 6 oz jars",
                  "unit price" : 25,
                  "units in stock" : 53,
                  "units on order" : 0,
                  "reorder level" : 0,
                  "discontinued" : "N"
                },
  ...           ...         ...</pre>
	    <pre class="prettyprint" data-lang="aggregate($project,$unwind)">    
db.orders.aggregate([{$project:{"product":"$SUPPLIER.supplies.PRODUCT",
                                "_id":0 }},
                     {$unwind:"$product"} ])</pre>
	  </ul>
	</li>
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 41 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue prettyprint">$out</h2>
    </hgroup>
    <article class="smaller">
      <ul class="build">
        <li>Find the names, categories, and unit prices of all products supplied and save the result in a collection <strong class="green prettyprint28">"products"</strong>
	  <ul class="build">
	    <pre class="prettyprint" data-lang="aggregate($project,$unwind,$project)">    
db.orders.aggregate([{$project:{"product":"$SUPPLIER.supplies.PRODUCT",
                                "_id":0 }},
                     {$unwind:"$product"},
                     {$project:{"name":"$product.product name",
                                "category":"$product.category name",
                                "price":"$product.unit price"}} ])</pre>
	    <pre class="prettyprint" data-lang="The results">   
{ "name" : "C√¥te de Blaye", "category" : "Beverages", "price" : 263.5 }
{ "name" : "Sasquatch Ale", "category" : "Beverages", "price" : 14 }
{ "name" : "Steeleye Stout", "category" : "Beverages", "price" : 18 }
  ...           ...         ...</pre>
	    <pre class="prettyprint" data-lang="aggregate($project,$unwind,$project,$out)">        
db.orders.aggregate([{$project:{"product":"$SUPPLIER.supplies.PRODUCT",
                                "_id":0 }},
                     {$unwind:"$product"},
                     {$project:{"name":"$product.product name",
                                "category":"$product.category name",
                                "price":"$product.unit price"}},
                     {$out:"products"}])</pre>
<pre class="prettyprint" data-lang="find()">db.products.find().pretty()</pre>	    	  
	  </ul>
	</li>
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 42 ================================================================================= -->
  <slide>
    <hgroup>
      <h2 class="blue">MongoDB Aggregation Framework</h2>
      <h3 class="red">Outline</h3>
    </hgroup>
    <article>
      <ul>	
       <li><a href="#03">Aggregation framework ? What is it ?</a></li>
       <li><a href="#07">Sample database</a></li>
       <li><a class="red" href="#13">Aggregation operators</a></li>
	  <ul>
	    <li><a href="#13"><strong class="prettyprint">$project</strong></a></li>
	    <li><a href="#16"><strong class="prettyprint">$match</strong></a></li>
	    <li><a href="#19"><strong class="prettyprint">$limit</strong>, <strong class="prettyprint">$skip</strong> and <strong class="prettyprint">$sample</strong></a></li>
	    <li><a href="#22"><strong class="prettyprint">$sort</strong> and <strong class="prettyprint">$count</strong></a></li>
	    <li><a href="#25"><strong class="prettyprint">$unwind</strong></a></li>
	    <li><a href="#30"><strong class="prettyprint">$group</strong></a></li>
	    <li><a href="#37"><strong class="prettyprint">$out</strong></a></li>
    	    <li><a class="red" href="#43"><strong class="prettyprint">$lookup</strong></a></li>
	  </ul>
      </ul>
<footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 43 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue prettyprint">$lookup</h2>
    </hgroup>
    <article class="smaller">
      <ul class="build">
        <li>Operation <strong class="green prettyprint28">$lookup</strong> performs a left outer join to an unsharded collection
	  in the same database to filter in documents from the "joined" collection for processing</li>
        <li>A collection <strong class="green prettyprint28">purchases</strong> created earlier
	  <ul class="build">
	    <pre class="prettyprint" data-lang="A collection purchases">       
{ "_id" : ObjectId("61342804f26c5a766e0e1c6f"),
  "Code" : "AROUT", "Purchased" : "Gorgonzola Telino" }
{ "_id" : ObjectId("61342804f26c5a766e0e1c70"),
  "Code" : "AROUT", "Purchased" : "Grandma's Boysenberry Spread" }
  ...           ...         ...</pre>
	  </ul>
	</li>
	<li>A collection <strong class="green prettyprint28">products</strong> created earlier
	  <ul class="build">
	    <pre class="prettyprint" data-lang="A collection products">   
{ "_id" : ObjectId("61342773f26c5a766e0e1c1a"),
  "name" : "Gorgonzola Telino","category" : "Dairy Products","price" : 12.5 }
{ "_id" : ObjectId("61342773f26c5a766e0e1c22"),
  "name" : "Grandma's Boysenberry Spread","category" : "Condiments","price" : 25 }
  ...           ...         ...</pre>	    	  
	  </ul>
	</li>
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 44 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue prettyprint">$lookup</h2>
    </hgroup>
    <article class="smallest">
      <ul class="build">
        <li>A left outer join of a collection <strong class="green prettyprint28">purchases</strong> with a collection <strong class="green prettyprint28">products</strong> over a condition <strong class="green prettyprint28">purchases.Purchased = products.name</strong>
	  <ul class="build">
	    <pre class="prettyprint" data-lang="aggregate($lookup)">       
db.purchases.aggregate([{$lookup: {from:"products",
                                   localField:"Purchased",
                                   foreignField:"name",
                                   as:"result"}} ])</pre>
	    <pre class="prettyprint" data-lang="purchases left outer join products">   
{ "_id" : ObjectId("61342804f26c5a766e0e1c6f"),
  "Code" : "AROUT","Purchased" : "Gorgonzola Telino",
   "result" : [ {"_id" : ObjectId("61342773f26c5a766e0e1c1a"),
                 "name" : "Gorgonzola Telino",
                 "category" : "Dairy Products",
                 "price" : 12.5}
              ]
}
{ "_id" : ObjectId("61342804f26c5a766e0e1c70"),
  "Code" : "AROUT","Purchased" : "Grandma's Boysenberry Spread",
  "result" : [ { "_id" : ObjectId("61342773f26c5a766e0e1c22"),
                 "name" : "Grandma's Boysenberry Spread",
                 "category" : "Condiments",
                 "price" : 25}
             ]
}
  ...           ...         ...</pre>	    	  
	  </ul>
	</li>
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 45 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue prettyprint">$lookup</h2>
    </hgroup>
    <article class="smallest">
      <ul class="build">
        <li>A left outer join of a collection <strong class="green prettyprint28">products</strong> with a collection <strong class="green prettyprint28">purchases</strong> over a condition <strong class="green prettyprint28">products.name = purchases.Purchased</strong>
	  <ul class="build">
	    <pre class="prettyprint" data-lang="aggregate($lookup)">       
db.products.aggregate([{$lookup: {from:"purchases",
                                  localField:"name",
                                  foreignField:"Purchased",
                                  as:"result"}} ])</pre>
	    <pre class="prettyprint" data-lang="products left outer join purchases">   
{"_id" : ObjectId("61342773f26c5a766e0e1c22"), "name" : "Grandma's Boysenberry Spread","category" : "Condiments", "price" : 25,
 "result" : [{"_id" : ObjectId("61342804f26c5a766e0e1c70"),"Code" : "AROUT","Purchased" : "Grandma's Boysenberry Spread"}]
}
{"_id" : ObjectId("61342773f26c5a766e0e1c1a"),"name" : "Gorgonzola Telino","category" : "Dairy Products","price" : 12.5,
 "result" : [{"_id" : ObjectId("61342804f26c5a766e0e1c6f"),"Code" : "AROUT","Purchased" : "Gorgonzola Telino"}]
}
  ...           ...         ...	    	  

{"_id" : ObjectId("61342773f26c5a766e0e1c0e"),"name" : "C√¥te de Blaye","category" : "Beverages","price" : 263.5,
 "result" : [ ]
}
{"_id" : ObjectId("61342773f26c5a766e0e1c0f"),"name" : "Sasquatch Ale","category" : "Beverages","price" : 14,
 "result" : [ ]
}
  ...           ...         ...</pre>	    	  
	  </ul>
	</li>
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>
<!-- slide 46 ================================================================================= -->
<slide>
    <hgroup>
      <h2 class="blue">References</h2>
    </hgroup>
    <article>
      <ul class="build">
	<li><a href="https://docs.mongodb.com/v4.2/aggregation/">MongoDB Manual, Aggregation</a></li>	
	<li>Banker K., Bakkum P., Verch S., Garret D., Hawkins T., MongoDB in Action, 2nd ed., Manning Publishers, 2016</li>
        <li>Chodorow K. MongoDB The Definitive Guide, O'Reilly, 2013</li>
      </ul>
      <footer class="source"><a href="#2">TOP</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
2023</footer>
    </article>
  </slide>


  <slide class="backdrop"></slide>


</slides>

<script>
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-XXXXXXXX-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>

<!--[if IE]>
  <script src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js"></script>
  <script>CFInstall.check({mode: 'overlay'});</script>
<![endif]-->
</body>
</html>
